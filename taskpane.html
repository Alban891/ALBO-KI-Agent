async function getCurrentEmail() {
    console.log('üìß === getCurrentEmail START ===');
    
    return new Promise((resolve) => {
        try {
            // Triple-check Office.js availability
            if (!Office || 
                !Office.context || 
                !Office.context.mailbox || 
                !Office.context.mailbox.item ||
                !Office.context.mailbox.item.subject ||
                !Office.context.mailbox.item.subject.getAsync) {
                
                console.log('‚ö†Ô∏è Office.js APIs not available - using demo email');
                resolve(generateDemoEmail());
                return;
            }
            
            let emailContent = '';
            let subjectCompleted = false;
            let bodyCompleted = false;
            let hasTimedOut = false;
            
            // Timeout-Handler
            const timeout = setTimeout(() => {
                hasTimedOut = true;
                console.log('‚è∞ Email reading timeout - using demo email');
                resolve(generateDemoEmail());
            }, 3000); // 3 Sekunden Timeout
            
            function checkIfComplete() {
                if (!hasTimedOut && subjectCompleted && bodyCompleted) {
                    clearTimeout(timeout);
                    console.log('üìß Email reading completed successfully');
                    console.log('üìß Final content length:', emailContent.length);
                    
                    if (emailContent.trim().length === 0) {
                        console.log('‚ö†Ô∏è Empty email content - using demo');
                        resolve(generateDemoEmail());
                    } else {
                        resolve(emailContent);
                    }
                }
            }
            
            // Subject lesen mit Error Handling
            try {
                Office.context.mailbox.item.subject.getAsync((subjectResult) => {
                    if (!hasTimedOut) {
                        console.log('üìß Subject read result:', subjectResult.status);
                        
                        if (subjectResult.status === Office.AsyncResultStatus.Succeeded) {
                            emailContent += `Betreff: ${subjectResult.value || 'Kein Betreff'}\n\n`;
                            console.log('‚úÖ Subject:', subjectResult.value);
                        } else {
                            console.log('‚ùå Subject read failed:', subjectResult.error?.message);
                            emailContent += 'Betreff: Konnte nicht gelesen werden\n\n';
                        }
                        
                        subjectCompleted = true;
                        checkIfComplete();
                    }
                });
            } catch (subjectError) {
                console.log('‚ùå Subject read exception:', subjectError);
                emailContent += 'Betreff: Fehler beim Lesen\n\n';
                subjectCompleted = true;
                checkIfComplete();
            }
            
            // Body lesen mit Error Handling
            try {
                Office.context.mailbox.item.body.getAsync("text", (bodyResult) => {
                    if (!hasTimedOut) {
                        console.log('üìß Body read result:', bodyResult.status);
                        
                        if (bodyResult.status === Office.AsyncResultStatus.Succeeded) {
                            const bodyText = bodyResult.value || 'Kein E-Mail-Inhalt verf√ºgbar';
                            emailContent += bodyText;
                            console.log('‚úÖ Body length:', bodyText.length);
                        } else {
                            console.log('‚ùå Body read failed:', bodyResult.error?.message);
                            emailContent += 'E-Mail-Inhalt konnte nicht gelesen werden';
                        }
                        
                        bodyCompleted = true;
                        checkIfComplete();
                    }
                });
            } catch (bodyError) {
                console.log('‚ùå Body read exception:', bodyError);
                emailContent += 'E-Mail-Inhalt: Fehler beim Lesen';
                bodyCompleted = true;
                checkIfComplete();
            }
            
        } catch (error) {
            console.error('‚ùå getCurrentEmail critical error:', error);
            resolve(generateDemoEmail());
        }
    });
}
