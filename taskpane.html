<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ALBO KI-Finance-Agent</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
    
    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
        
        <!-- Header -->
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: #2c3e50; font-size: 1.8em; margin: 0;">ü§ñ ALBO KI-Agent</h1>
            <p style="color: #7f8c8d; margin: 5px 0 0 0;">Intelligente Finance-Automatisierung</p>
        </div>
        
        <!-- Agent Selector -->
        <div style="margin-bottom: 25px;">
            <label style="display: block; margin-bottom: 15px; font-weight: 600; color: #2c3e50;">KI-Agent ausw√§hlen:</label>
            
            <!-- Agent Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                
                <!-- Agent 1: Finance Expert -->
                <div onclick="selectAgent('finance_expert', 'Finance Expert', this)" 
                     style="border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center; transition: all 0.3s ease;"
                     onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';"
                     onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#e9ecef'; this.style.background='white'; }">
                    <div style="font-size: 2em; margin-bottom: 10px;">üí∞</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">Finance Expert</div>
                    <div style="font-size: 0.8em; opacity: 0.8;">Finanzanalyse & Berichte</div>
                </div>
                
                <!-- Agent 2: Business Assistant -->
                <div onclick="selectAgent('business_assistant', 'Business Assistant', this)" 
                     style="border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center; transition: all 0.3s ease;"
                     onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';"
                     onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#e9ecef'; this.style.background='white'; }">
                    <div style="font-size: 2em; margin-bottom: 10px;">üìä</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">Business Assistant</div>
                    <div style="font-size: 0.8em; opacity: 0.8;">Allgemeine Gesch√§ftshilfe</div>
                </div>
                
                <!-- Agent 3: Content Writer -->
                <div onclick="selectAgent('content_writer', 'Content Writer', this)" 
                     style="border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center; transition: all 0.3s ease;"
                     onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';"
                     onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#e9ecef'; this.style.background='white'; }">
                    <div style="font-size: 2em; margin-bottom: 10px;">‚úçÔ∏è</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">Content Writer</div>
                    <div style="font-size: 0.8em; opacity: 0.8;">Texterstellung & Korrektur</div>
                </div>
                
                <!-- Agent 4: Data Analyst -->
                <div onclick="selectAgent('data_analyst', 'Data Analyst', this)" 
                     style="border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; text-align: center; transition: all 0.3s ease;"
                     onmouseover="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';"
                     onmouseout="if(!this.classList.contains('selected')) { this.style.borderColor='#e9ecef'; this.style.background='white'; }">
                    <div style="font-size: 2em; margin-bottom: 10px;">üìà</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">Data Analyst</div>
                    <div style="font-size: 0.8em; opacity: 0.8;">Datenauswertung</div>
                </div>
                
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div style="margin-top: 25px;">
            <button onclick="processEmail('auto')" 
                    style="width: 100%; padding: 15px; margin-bottom: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #51cf66, #40c057); color: white; transition: all 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';"
                    onmouseout="this.style.transform='none'; this.style.boxShadow='none';">
                ‚ö° Vollst√§ndig automatisch
            </button>
            
            <button onclick="processEmail('draft')" 
                    style="width: 100%; padding: 15px; margin-bottom: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #339af0, #228be6); color: white; transition: all 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';"
                    onmouseout="this.style.transform='none'; this.style.boxShadow='none';">
                üìù Als Entwurf speichern
            </button>
            
            <button onclick="processEmail('review')" 
                    style="width: 100%; padding: 15px; margin-bottom: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; background: linear-gradient(135deg, #ff8cc8, #fd79a8); color: white; transition: all 0.3s ease;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)';"
                    onmouseout="this.style.transform='none'; this.style.boxShadow='none';">
                üîç √úberdenken & Entwurf
            </button>
        </div>
        
        <!-- Email Content Display -->
        <div id="emailPreview" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">üìß Aktuelle E-Mail:</h4>
            <div id="emailContent" style="font-size: 14px; color: #6c757d; max-height: 100px; overflow-y: auto;"></div>
        </div>
        
        <!-- AI Response Display -->
        <div id="aiResponse" style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; display: none;">
            <h4 style="margin: 0 0 10px 0; color: #1976d2;">ü§ñ KI-Analyse:</h4>
            <div id="analysisContent"></div>
            <div id="draftContent" style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; border-left: 4px solid #1976d2;"></div>
        </div>
        
        <!-- Status Display -->
        <div id="status" style="margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; display: none;"></div>
        
        <!-- Enterprise Info -->
        <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px; color: #6c757d; text-align: center;">
            üè¢ ALBO Enterprise Finance Solutions | Powered by Multi-LLM AI
        </div>
        
    </div>

    <script>
        // Global Variables
        let selectedAgent = null;
        let selectedAgentName = '';
        let currentEmailContent = '';
        
        // ALBO Enterprise Agent Templates
        const ALBO_AGENTS = {
            finance_expert: {
                id: 'finance_expert',
                name: 'Finance Expert',
                icon: 'üí∞',
                description: 'Finanzanalyse & Berichte',
                templates: {
                    auto: {
                        analysis: 'Finanzielle E-Mail analysiert: Rechnungsrelevant, Betrag erkannt, Zahlungsziel identifiziert.',
                        response: 'Vielen Dank f√ºr Ihre Rechnung. Wir haben sie zur Bearbeitung an unsere Buchhaltung weitergeleitet. Die Zahlung erfolgt fristgerecht gem√§√ü den vereinbarten Zahlungskonditionen.'
                    },
                    draft: {
                        analysis: 'Finance-Entwurf erstellt: Professionelle Buchhaltungsantwort, compliance-konform.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr Ihr Schreiben. Wir haben Ihre Unterlagen erhalten und werden diese umgehend in unserem Finance-System bearbeiten.\n\nF√ºr R√ºckfragen stehen wir gerne zur Verf√ºgung.\n\nMit freundlichen Gr√º√üen\nIhr ALBO Finance Team'
                    },
                    review: {
                        analysis: 'Detaillierte Finance-Analyse: Kostenstelle erforderlich, Budget-Impact pr√ºfen, Freigabe-Workflow aktivieren.',
                        response: 'Sehr geehrte Damen und Herren,\n\nwir best√§tigen den Erhalt Ihrer Unterlagen. Zur ordnungsgem√§√üen Bearbeitung ben√∂tigen wir noch folgende Informationen:\n\n- Kostenstelle/Projekt-Zuordnung\n- Genehmigung durch verantwortlichen Manager\n\nSobald uns diese Angaben vorliegen, erfolgt die weitere Bearbeitung umgehend.\n\nVielen Dank f√ºr Ihr Verst√§ndnis.'
                    }
                }
            },
            business_assistant: {
                id: 'business_assistant',
                name: 'Business Assistant',
                icon: 'üìä',
                description: 'Allgemeine Gesch√§ftshilfe',
                templates: {
                    auto: {
                        analysis: 'Gesch√§fts-E-Mail klassifiziert: Routine-Anfrage, Standard-Workflow anwendbar.',
                        response: 'Vielen Dank f√ºr Ihre Nachricht. Wir haben Ihre Anfrage erhalten und werden uns zeitnah bei Ihnen melden. Bei dringenden Angelegenheiten erreichen Sie uns telefonisch.'
                    },
                    draft: {
                        analysis: 'Business-Kommunikation analysiert: Professional Response erforderlich.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr Ihr Interesse an unseren Dienstleistungen. Gerne unterst√ºtzen wir Sie bei Ihrem Anliegen.\n\nIch werde Ihre Anfrage an den zust√§ndigen Fachbereich weiterleiten und mich schnellstm√∂glich bei Ihnen melden.\n\nMit freundlichen Gr√º√üen'
                    },
                    review: {
                        analysis: 'Komplexe Business-Anfrage: Stakeholder-Abstimmung erforderlich, strategische Relevanz pr√ºfen.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr Ihre detaillierte Anfrage. Aufgrund der Komplexit√§t Ihres Anliegens m√∂chte ich zun√§chst eine interne Abstimmung mit unseren Fachexperten durchf√ºhren.\n\nIch werde mich binnen 48 Stunden mit einer fundierten Antwort bei Ihnen melden.\n\nVielen Dank f√ºr Ihr Verst√§ndnis.'
                    }
                }
            },
            content_writer: {
                id: 'content_writer',
                name: 'Content Writer',
                icon: '‚úçÔ∏è',
                description: 'Texterstellung & Korrektur',
                templates: {
                    auto: {
                        analysis: 'Textoptimierung durchgef√ºhrt: Stil verbessert, Grammatik korrigiert, Professional Tone angewendet.',
                        response: 'Vielen Dank f√ºr Ihre Nachricht. Ihre Anfrage wurde stilistisch optimiert und wird in verbesserter Form weitergeleitet. Wir sch√§tzen Ihre professionelle Kommunikation.'
                    },
                    draft: {
                        analysis: 'Content-Review abgeschlossen: Klare Struktur, angemessener Ton, Corporate Language.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr Ihre wertvolle Nachricht. Wir haben Ihr Anliegen sorgf√§ltig gepr√ºft und m√∂chten Ihnen eine umfassende Antwort geben.\n\nGerne stehen wir f√ºr weitere Fragen zur Verf√ºgung und freuen uns auf eine erfolgreiche Zusammenarbeit.\n\nMit herzlichen Gr√º√üen'
                    },
                    review: {
                        analysis: 'Umfassende Textanalyse: Zielgruppen-Ansprache optimieren, Markenkommunikation abstimmen.',
                        response: 'Sehr geehrte Damen und Herren,\n\nwir bedanken uns f√ºr Ihr Vertrauen und Ihre Nachricht. Ihre Anfrage hat unsere volle Aufmerksamkeit und wir m√∂chten sicherstellen, dass unsere Antwort Ihren Erwartungen entspricht.\n\nErlauben Sie uns, Ihre Anfrage im Detail zu pr√ºfen und Ihnen eine ma√ügeschneiderte L√∂sung zu pr√§sentieren.\n\nWir melden uns zeitnah bei Ihnen.'
                    }
                }
            },
            data_analyst: {
                id: 'data_analyst',
                name: 'Data Analyst',
                icon: 'üìà',
                description: 'Datenauswertung',
                templates: {
                    auto: {
                        analysis: 'Datenanalyse abgeschlossen: Trends erkannt, KPIs extrahiert, automatische Insights generiert.',
                        response: 'Ihre Daten wurden erfolgreich analysiert. Die wichtigsten Kennzahlen wurden extrahiert und stehen zur weiteren Verarbeitung bereit. Ein detaillierter Report folgt in K√ºrze.'
                    },
                    draft: {
                        analysis: 'Analytische Auswertung: Datenqualit√§t gepr√ºft, Visualisierung vorbereitet.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr die Bereitstellung Ihrer Daten. Unsere erste Analyse zeigt interessante Trends und Potentiale.\n\nWir erstellen derzeit einen detaillierten Analysebericht mit Handlungsempfehlungen und werden Ihnen diesen in den n√§chsten Tagen zukommen lassen.\n\nMit analytischen Gr√º√üen'
                    },
                    review: {
                        analysis: 'Tiefgehende Datenanalyse erforderlich: Komplexe Korrelationen, predictive Modeling, strategische Insights.',
                        response: 'Sehr geehrte Damen und Herren,\n\nvielen Dank f√ºr Ihr Vertrauen in unsere Analysekompetenz. Die von Ihnen bereitgestellten Daten erfordern eine sorgf√§ltige und tiefgehende Auswertung.\n\nWir werden verschiedene Analysemethoden anwenden und Ihnen einen umfassenden Bericht mit strategischen Handlungsempfehlungen erstellen.\n\nDie Bearbeitung wird ca. 5-7 Werktage in Anspruch nehmen.'
                    }
                }
            }
        };
        
        // Office.js Ready - ULTRA SAFE VERSION
        Office.onReady(function() {
            console.log('‚úÖ Office Add-In bereit!');
            showStatus('ALBO KI-Agent geladen!', 'success');
            loadCurrentEmail();
        });
        
        // Load current email - SAFE VERSION
        function loadCurrentEmail() {
            try {
                currentEmailContent = generateDemoEmail();
                showEmailPreview(currentEmailContent);
                console.log('üìß Demo E-Mail geladen');
            } catch (error) {
                console.log('üìß Email loading error:', error);
                currentEmailContent = 'Demo E-Mail konnte nicht geladen werden.';
                showEmailPreview(currentEmailContent);
            }
        }
        
        function generateDemoEmail() {
            var demoEmails = [
                "Betreff: Mahnung - Rechnung Nr. 2024-001\n\nSehr geehrte Damen und Herren,\n\nanbei erhalten Sie die Rechnung Nr. 2024-001 √ºber 1.500,00 EUR. Bitte √ºberweisen Sie den Betrag bis zum 30.11.2024.\n\nMit freundlichen Gr√º√üen\nMusterfirma GmbH",
                "Betreff: Angebot f√ºr Consulting\n\nHallo,\n\nwir ben√∂tigen ein Angebot f√ºr Ihre Consulting-Dienstleistungen. K√∂nnen Sie uns bis Freitag eine Kostensch√§tzung zukommen lassen?\n\nBeste Gr√º√üe\nMax Mustermann",
                "Betreff: Q3 Quartalsbericht\n\nLiebes Team,\n\nbitte finden Sie im Anhang unseren Q3-Bericht. Die Zahlen zeigen ein Wachstum von 15% gegen√ºber dem Vorjahr.\n\nGr√º√üe aus der Finanzabteilung\nAnna Schmidt"
            ];
            
            return demoEmails[Math.floor(Math.random() * demoEmails.length)];
        }
        
        function showEmailPreview(content) {
            var preview = document.getElementById('emailPreview');
            var emailContent = document.getElementById('emailContent');
            
            if (preview && emailContent) {
                emailContent.textContent = content.substring(0, 200) + (content.length > 200 ? '...' : '');
                preview.style.display = 'block';
            }
        }
        
        // Agent Selection
        function selectAgent(agentId, agentName, element) {
            selectedAgent = ALBO_AGENTS[agentId];
            selectedAgentName = agentName;
            
            // Reset all cards
            var cards = document.querySelectorAll('[onclick*="selectAgent"]');
            for (var i = 0; i < cards.length; i++) {
                cards[i].style.borderColor = '#e9ecef';
                cards[i].style.background = 'white';
                cards[i].style.color = 'black';
                cards[i].classList.remove('selected');
            }
            
            // Highlight selected card
            element.style.borderColor = '#667eea';
            element.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            element.style.color = 'white';
            element.classList.add('selected');
            
            showStatus('‚úÖ Agent "' + agentName + '" ausgew√§hlt', 'success');
            console.log('üéØ Agent ausgew√§hlt:', selectedAgent);
        }
        
        // SAFE processEmail function
        function processEmail(actionType) {
            if (!selectedAgent) {
                showStatus('‚ùå Bitte w√§hlen Sie zuerst einen Agent aus', 'error');
                return;
            }
            
            try {
                showStatus('ü§ñ ' + selectedAgent.name + ' verarbeitet E-Mail...', 'loading');
                
                // Simulation der Verarbeitung
                setTimeout(function() {
                    var template = selectedAgent.templates[actionType];
                    if (template) {
                        showAIResponse(template.analysis, template.response);
                        showStatus('‚úÖ ' + selectedAgent.name + ': Verarbeitung abgeschlossen', 'success');
                        console.log('‚úÖ Email verarbeitet mit:', actionType);
                    }
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå Processing error:', error);
                showStatus('‚ùå Verarbeitung fehlgeschlagen', 'error');
            }
        }
        
        function showAIResponse(analysis, draftResponse) {
            var responseDiv = document.getElementById('aiResponse');
            var analysisContent = document.getElementById('analysisContent');
            var draftContent = document.getElementById('draftContent');
            
            if (responseDiv && analysisContent && draftContent) {
                analysisContent.innerHTML = '<strong>Analyse:</strong> ' + analysis;
                draftContent.innerHTML = '<strong>Antwort-Entwurf:</strong><br><pre style="white-space: pre-wrap; font-family: inherit;">' + draftResponse + '</pre>';
                responseDiv.style.display = 'block';
            }
        }
        
        // Status Display
        function showStatus(message, type) {
            var status = document.getElementById('status');
            if (!status) return;
            
            status.style.display = 'block';
            
            // Style based on type
            if (type === 'success') {
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                status.style.border = '1px solid #f5c6cb';
            } else if (type === 'loading') {
                status.style.background = '#d1ecf1';
                status.style.color = '#0c5460';
                status.style.border = '1px solid #bee5eb';
                message = '‚è≥ ' + message;
            }
            
            status.innerHTML = message;
            
            // Auto-hide after 5 seconds (except loading)
            if (type !== 'loading') {
                setTimeout(function() {
                    status.style.display = 'none';
                }, 5000);
            }
        }
        
        // Initialize
        console.log('üöÄ ALBO KI-Agent loaded - Ultra Safe Version');
    </script>

</body>
</html>
